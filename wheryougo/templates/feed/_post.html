{% extends "base.html" %}

{% block content %}
<div class="post-detail max-w-4xl mx-auto p-4 bg-white rounded-lg shadow-md">
<h2 class="text-5xl font-bold mb-4">{{ post.title }}</h2>

  <!-- Post Content -->
  <p class="mb-6 text-gray-700">{{ post.content }}</p>

  <!-- Large Images -->
  {% if post.images.all %}
    <div class="post-images grid grid-cols-3 gap-4 mb-6">
      {% for image in post.images.all %}
        <div class="image-item">
          <img src="{{ image.image.url }}" alt="{{ image.caption|default:post.title }}" class="w-full h-auto rounded-md">
          {% if image.caption %}
            <p class="text-sm text-gray-500 mt-1">{{ image.caption }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Like count and who liked -->
  <div class="likes-info mb-4 text-sm text-gray-600">
    ❤️ {{ post.likes.count }} 
    {% if post.likes.count > 0 %}
      - Liked by
      {% for like in post.likes.all|slice:":5" %}
        <span class="font-semibold">{{ like.user.username }}</span>{% if not forloop.last %}, {% endif %}
      {% endfor %}
      {% if post.likes.count > 5 %}and {{ post.likes.count|add:"-5" }} more{% endif %}
    {% endif %}
  </div>

  <!-- Comments Section -->
  <div class="comments-section">
    <h3 class="text-lg font-semibold mb-3">Comments - {{ post.comments.count }} yet</h3>

    <!-- List comments -->
    <div class="space-y-3 mb-4 max-h-72 overflow-y-auto">
      {% for comment in post.comments.all %}
        <div class="comment p-2 bg-gray-100 rounded">
          <p>
            <a href="{% url 'profile' comment.author %}" class="font-semibold">{{ comment.author.username }}</a>:
            {{ comment.content }}
          </p>
          <small class="text-xs text-gray-500">{{ comment.created_at|timesince }} ago</small>
        </div>
      {% empty %}
        <p class="text-gray-500">No comments yet. Be the first to comment!</p>
      {% endfor %}
    </div>

    {% if user.is_authenticated %}
      <!-- Comment form -->
      <form method="post" id="comment-form-{{ post.id }}" class="space-y-2" action="{% url 'comment' post.id %}">
        {% csrf_token %}
        <textarea name="comment" rows="3" placeholder="Write your comment..." required
                  class="w-full border border-gray-300 rounded p-2"></textarea>
        <button type="submit" class="px-4 py-2 bg-travel-blue text-white rounded hover:bg-blue-700">
          Add Comment
        </button>
        <a href="{% url 'feed' %}" class="px-4 py-2 bg-travel-blue text-white rounded hover:bg-blue-700">
            Go back
        </a>
      </form>
    {% else %}
      <p class="text-gray-600">Please <a href="{% url 'signin' %}" class="text-travel-blue">sign in</a> to comment.</p>
    {% endif %}
  </div>
</div>

{% endblock %}